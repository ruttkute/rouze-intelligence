<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results Dashboard - ROUZE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0314 0%, #0f0520 15%, #1a0d2e 30%, #1f1530 45%, #2a1f3d 50%, #1f1530 55%, #0d0818 85%, #0a0314 100%);
            background-attachment: fixed;
            color: #B0A6DF;
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-bar {
            background: rgba(26, 13, 46, 0.4);
            border-bottom: 1px solid rgba(176, 166, 223, 0.1);
            backdrop-filter: blur(10px);
            padding: 24px 40px;
            margin: -20px -20px 40px -20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            color: #B0A6DF;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            font-size: 13px;
        }

        .nav-links a {
            color: rgba(176, 166, 223, 0.6);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #B0A6DF;
        }

        /* HEADER */
        .dashboard-header {
            background: rgba(82, 66, 92, 0.15);
            border: 1px solid rgba(176, 166, 223, 0.15);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .header-title h1 {
            font-family: 'Playfair Display', serif;
            font-size: 36px;
            font-weight: 700;
            color: #B0A6DF;
            margin-bottom: 8px;
        }

        .header-meta {
            font-size: 12px;
            color: rgba(176, 166, 223, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .header-status {
            text-align: right;
        }

        .status-badge {
            display: inline-block;
            background: rgba(58, 143, 195, 0.15);
            border: 1px solid rgba(58, 143, 195, 0.3);
            color: #3A8FC3;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .expiration {
            font-size: 12px;
            color: rgba(176, 166, 223, 0.6);
        }

        /* EXECUTIVE SUMMARY */
        .section {
            margin-bottom: 50px;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            font-weight: 700;
            color: #B0A6DF;
            margin-bottom: 24px;
            border-bottom: 1px solid rgba(176, 166, 223, 0.1);
            padding-bottom: 16px;
        }

        .findings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .finding-card {
            background: rgba(82, 66, 92, 0.15);
            border: 1px solid rgba(176, 166, 223, 0.15);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .finding-card:hover {
            background: rgba(82, 66, 92, 0.25);
            border-color: rgba(176, 166, 223, 0.25);
            transform: translateY(-2px);
        }

        .finding-title {
            font-size: 16px;
            font-weight: 600;
            color: #B0A6DF;
            margin-bottom: 8px;
        }

        .finding-description {
            font-size: 13px;
            color: rgba(176, 166, 223, 0.8);
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .finding-impact {
            font-size: 12px;
            color: #3A8FC3;
            font-weight: 500;
        }

        /* METRICS GRID */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: rgba(82, 66, 92, 0.15);
            border: 1px solid rgba(176, 166, 223, 0.15);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            background: rgba(82, 66, 92, 0.25);
            border-color: rgba(176, 166, 223, 0.25);
        }

        .metric-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #3A8FC3;
            margin-bottom: 12px;
        }

        .metric-value {
            font-size: 48px;
            font-weight: 700;
            color: #B0A6DF;
            margin-bottom: 8px;
        }

        .metric-value.score {
            font-size: 40px;
        }

        .metric-value.score::after {
            font-size: 24px;
            color: rgba(176, 166, 223, 0.6);
            content: '/10';
            margin-left: 4px;
        }

        .metric-description {
            font-size: 12px;
            color: rgba(176, 166, 223, 0.7);
        }

        /* CHARTS SECTION */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .chart-container {
            background: rgba(82, 66, 92, 0.15);
            border: 1px solid rgba(176, 166, 223, 0.15);
            border-radius: 12px;
            padding: 24px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: #B0A6DF;
            margin-bottom: 20px;
        }

        .chart-canvas {
            position: relative;
            height: 300px;
        }

        /* SIGNALS LIBRARY */
        .signals-container {
            background: rgba(82, 66, 92, 0.15);
            border: 1px solid rgba(176, 166, 223, 0.15);
            border-radius: 12px;
            padding: 24px;
        }

        .signals-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .filter-select {
            background: rgba(82, 66, 92, 0.3);
            border: 1px solid rgba(176, 166, 223, 0.2);
            color: #B0A6DF;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:hover {
            background: rgba(82, 66, 92, 0.5);
            border-color: rgba(176, 166, 223, 0.3);
        }

        .signals-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-height: 800px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .signal-item {
            background: rgba(82, 66, 92, 0.2);
            border: 1px solid rgba(176, 166, 223, 0.1);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .signal-item:hover {
            background: rgba(82, 66, 92, 0.3);
            border-color: rgba(176, 166, 223, 0.2);
        }

        .signal-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .signal-platform {
            color: #3A8FC3;
            font-weight: 600;
        }

        .signal-date {
            color: rgba(176, 166, 223, 0.6);
        }

        .signal-text {
            font-size: 13px;
            color: rgba(176, 166, 223, 0.85);
            line-height: 1.5;
            margin-bottom: 8px;
            font-style: italic;
        }

        .signal-analysis {
            font-size: 12px;
            color: rgba(176, 166, 223, 0.7);
            margin-bottom: 8px;
        }

        .signal-confidence {
            font-size: 11px;
            color: #3A8FC3;
            font-weight: 600;
        }

        /* RECOMMENDATIONS */
        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .recommendation-card {
            background: rgba(82, 66, 92, 0.15);
            border: 1px solid rgba(176, 166, 223, 0.15);
            border-radius: 12px;
            padding: 24px;
            border-left: 4px solid #3A8FC3;
        }

        .rec-priority {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #3A8FC3;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .rec-title {
            font-size: 16px;
            font-weight: 600;
            color: #B0A6DF;
            margin-bottom: 8px;
        }

        .rec-description {
            font-size: 13px;
            color: rgba(176, 166, 223, 0.8);
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .rec-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: rgba(176, 166, 223, 0.6);
        }

        /* EXPORT BUTTONS */
        .export-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid rgba(176, 166, 223, 0.1);
        }

        .export-button {
            padding: 12px 24px;
            background: rgba(58, 143, 195, 0.1);
            border: 1px solid rgba(58, 143, 195, 0.3);
            color: #3A8FC3;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .export-button:hover {
            background: rgba(58, 143, 195, 0.2);
            border-color: rgba(58, 143, 195, 0.5);
            transform: translateY(-2px);
        }

        /* METHODOLOGY */
        .methodology-section {
            background: rgba(82, 66, 92, 0.15);
            border: 1px solid rgba(176, 166, 223, 0.15);
            border-radius: 12px;
            padding: 24px;
        }

        .methodology-text {
            font-size: 13px;
            color: rgba(176, 166, 223, 0.8);
            line-height: 1.7;
        }

        .methodology-text strong {
            color: #B0A6DF;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(176, 166, 223, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(58, 143, 195, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(58, 143, 195, 0.5);
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .metric-value {
                font-size: 36px;
            }

            .finding-card {
                min-height: auto;
            }

            .export-buttons {
                flex-direction: column;
            }

            .export-button {
                width: 100%;
            }
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            font-size: 16px;
            color: rgba(176, 166, 223, 0.7);
        }

        .error {
            background: rgba(220, 100, 100, 0.05);
            border: 1px solid rgba(220, 100, 100, 0.3);
            color: rgba(220, 100, 100, 0.9);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="nav-bar">
        <div class="logo">ROUZE</div>
        <div class="nav-links">
            <a href="/">Home</a>
            <a href="/methodology">Methodology</a>
            <a href="/pricing">Pricing</a>
        </div>
    </div>

    <div class="dashboard-container">
        <div id="loadingState" class="loading">Loading your analysis...</div>
        <div id="errorState" class="error" style="display: none;"></div>
        <div id="dashboardContent" style="display: none;">

            <!-- HEADER -->
            <div class="dashboard-header">
                <div class="header-top">
                    <div class="header-title">
                        <h1 id="projectTitle">Analysis Title</h1>
                        <div class="header-meta" id="projectMeta">Loading...</div>
                    </div>
                    <div class="header-status">
                        <div class="status-badge">COMPLETE</div>
                        <div class="expiration" id="expirationText">Expires in 89 days</div>
                    </div>
                </div>
            </div>

            <!-- EXECUTIVE SUMMARY -->
            <div class="section">
                <h2 class="section-title">Key Findings</h2>
                <div class="findings-grid" id="executiveSummary">
                    <div class="loading" style="padding: 20px;">Loading findings...</div>
                </div>
            </div>

            <!-- KEY METRICS -->
            <div class="section">
                <h2 class="section-title">Market Intelligence Scores</h2>
                <div class="metrics-grid" id="metricsGrid">
                    <div class="loading" style="padding: 20px;">Loading metrics...</div>
                </div>
            </div>

            <!-- CHARTS -->
            <div class="section">
                <h2 class="section-title">Trend Analysis</h2>
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">Signal Volume Trend (90 Days)</div>
                        <div class="chart-canvas">
                            <canvas id="demandChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Sentiment Distribution</div>
                        <div class="chart-canvas">
                            <canvas id="sentimentChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Competitor Positioning</div>
                        <div class="chart-canvas">
                            <canvas id="competitorChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIGNALS LIBRARY -->
            <div class="section">
                <h2 class="section-title">Raw Signals by Platform</h2>
                <div class="signals-container">
                    <div class="signals-filters">
                        <select id="platformFilter" class="filter-select" onchange="filterSignals()">
                            <option value="">All Platforms</option>
                            <option value="Reddit">Reddit</option>
                            <option value="Amazon">Amazon Reviews</option>
                            <option value="Twitter">Twitter</option>
                            <option value="G2">G2 Reviews</option>
                            <option value="TikTok">TikTok</option>
                            <option value="YouTube">YouTube</option>
                        </select>
                        <select id="sentimentFilter" class="filter-select" onchange="filterSignals()">
                            <option value="">All Sentiment</option>
                            <option value="positive">Positive</option>
                            <option value="neutral">Neutral</option>
                            <option value="negative">Negative</option>
                        </select>
                    </div>
                    <div class="signals-list" id="signalsList">
                        <div class="loading" style="padding: 20px;">Loading signals...</div>
                    </div>
                </div>
            </div>

            <!-- RECOMMENDATIONS -->
            <div class="section">
                <h2 class="section-title">Strategic Recommendations</h2>
                <div class="recommendations-grid" id="recommendationsGrid">
                    <div class="loading" style="padding: 20px;">Loading recommendations...</div>
                </div>
            </div>

            <!-- METHODOLOGY -->
            <div class="section">
                <h2 class="section-title">Methodology & Transparency</h2>
                <div class="methodology-section">
                    <div class="methodology-text">
                        <strong>How This Analysis Was Created:</strong><br><br>
                        We collected <strong id="signalCount">0</strong> raw signals from <strong id="sourceCount">0</strong> independent data sources over 90 days. 
                        Signals were cross-validated (appearing in 2+ sources) and filtered for statistical significance (p < 0.05). 
                        Confidence scoring indicates the likelihood this pattern reflects true market reality rather than noise. 
                        <strong id="confidenceLevel">85%</strong> overall analysis confidence.<br><br>
                        <strong>What These Signals Mean:</strong><br>
                        Market sentiment is aggregated from unfiltered customer conversations, not surveys or sponsored content. 
                        This reflects what customers are actually saying, not what they think researchers want to hear.
                    </div>
                </div>
            </div>

            <!-- EXPORT BUTTONS -->
            <div class="export-buttons">
                <button class="export-button" onclick="exportFormat('pdf')">Download PDF Report</button>
                <button class="export-button" onclick="exportFormat('pptx')">Download Presentation</button>
                <button class="export-button" onclick="exportFormat('csv')">Download Data (CSV)</button>
                <button class="export-button" onclick="exportFormat('png')">Download Charts (PNG)</button>
            </div>
        </div>
    </div>

    <script>
        // GET PROJECT ID FROM URL
        const projectId = window.location.pathname.split('/').pop();
        let dashboardData = null;
        let allSignals = [];
        let chartInstances = {};

        // LOAD DASHBOARD DATA
        async function loadDashboard() {
            try {
                const response = await fetch(`/api/dashboard/${projectId}`);
                if (!response.ok) throw new Error('Failed to load dashboard');
                
                dashboardData = await response.json();
                allSignals = dashboardData.signals || [];
                
                renderDashboard();
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('errorState').style.display = 'block';
                document.getElementById('errorState').textContent = 'Error loading analysis. Please refresh the page.';
            }
        }

        // RENDER DASHBOARD
        function renderDashboard() {
            // Header
            document.getElementById('projectTitle').textContent = dashboardData.project_title || 'Market Intelligence Analysis';
            document.getElementById('projectMeta').textContent = `${dashboardData.vertical.toUpperCase()} â€¢ ${dashboardData.tier.toUpperCase()}`;
            
            // Expiration
            const daysLeft = dashboardData.days_remaining || 90;
            document.getElementById('expirationText').textContent = `Expires in ${daysLeft} days`;

            // Executive Summary
            renderFindings(dashboardData.executive_summary);

            // Metrics
            renderMetrics(dashboardData.metrics);

            // Charts
            renderCharts();

            // Signals
            renderSignals();

            // Recommendations
            renderRecommendations(dashboardData.recommendations);

            // Methodology
            document.getElementById('signalCount').textContent = dashboardData.signal_count || '25,000+';
            document.getElementById('sourceCount').textContent = dashboardData.source_count || '12';
            document.getElementById('confidenceLevel').textContent = (dashboardData.metrics?.confidence || 85) + '%';
        }

        function renderFindings(findings) {
            const container = document.getElementById('executiveSummary');
            container.innerHTML = '';
            
            if (!findings || findings.length === 0) {
                container.innerHTML = '<div style="color: rgba(176, 166, 223, 0.6);">No findings available</div>';
                return;
            }

            findings.forEach(finding => {
                const card = document.createElement('div');
                card.className = 'finding-card';
                card.innerHTML = `
                    <div class="finding-title">${finding.title || 'Finding'}</div>
                    <div class="finding-description">${finding.description || ''}</div>
                    <div class="finding-impact">${finding.impact || ''}</div>
                `;
                container.appendChild(card);
            });
        }

        function renderMetrics(metrics) {
            const container = document.getElementById('metricsGrid');
            container.innerHTML = '';

            const metricsList = [
                { label: 'Demand Score', value: metrics.demand_score, format: 'score' },
                { label: 'Competition Level', value: metrics.competition_level, format: 'score' },
                { label: 'Confidence Level', value: metrics.confidence, format: 'percent' },
                { label: 'Key Opportunity', value: metrics.opportunity, format: 'text' }
            ];

            metricsList.forEach(metric => {
                const card = document.createElement('div');
                card.className = 'metric-card';
                
                let valueHTML;
                if (metric.format === 'score') {
                    valueHTML = `<div class="metric-value score">${metric.value || 0}</div>`;
                } else if (metric.format === 'percent') {
                    valueHTML = `<div class="metric-value">${metric.value || 0}%</div>`;
                } else {
                    valueHTML = `<div class="metric-value" style="font-size: 18px; white-space: normal;">${metric.value || 'N/A'}</div>`;
                }

                card.innerHTML = `
                    <div class="metric-label">${metric.label}</div>
                    ${valueHTML}
                    <div class="metric-description">${metric.label}</div>
                `;
                container.appendChild(card);
            });
        }

        function renderCharts() {
            const demandData = dashboardData.charts?.demand_trend || [];
            const sentimentData = dashboardData.charts?.sentiment_distribution || {};
            const competitorData = dashboardData.charts?.competitor_positioning || [];

            // DEMAND TREND CHART
            const demandCtx = document.getElementById('demandChart').getContext('2d');
            if (chartInstances.demand) chartInstances.demand.destroy();
            
            chartInstances.demand = new Chart(demandCtx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 15', 'Day 30', 'Day 45', 'Day 60', 'Day 90'],
                    datasets: [{
                        label: 'Signal Volume',
                        data: demandData.length > 0 ? demandData : [234, 456, 678, 892, 1045, 2400],
                        borderColor: '#3A8FC3',
                        backgroundColor: 'rgba(58, 143, 195, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#3A8FC3',
                        pointBorderColor: '#3A8FC3',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: { color: '#B0A6DF' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: 'rgba(176, 166, 223, 0.6)' },
                            grid: { color: 'rgba(176, 166, 223, 0.1)' }
                        },
                        x: {
                            ticks: { color: 'rgba(176, 166, 223, 0.6)' },
                            grid: { color: 'rgba(176, 166, 223, 0.1)' }
                        }
                    }
                }
            });

            // SENTIMENT CHART
            const sentimentCtx = document.getElementById('sentimentChart').getContext('2d');
            if (chartInstances.sentiment) chartInstances.sentiment.destroy();
            
            const sentimentValues = [
                sentimentData.positive || 64,
                sentimentData.neutral || 22,
                sentimentData.negative || 14
            ];

            chartInstances.sentiment = new Chart(sentimentCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Positive', 'Neutral', 'Negative'],
                    datasets: [{
                        data: sentimentValues,
                        backgroundColor: [
                            'rgba(58, 143, 195, 0.6)',
                            'rgba(176, 166, 223, 0.3)',
                            'rgba(220, 100, 100, 0.3)'
                        ],
                        borderColor: [
                            '#3A8FC3',
                            '#B0A6DF',
                            '#DC6464'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#B0A6DF' }
                        }
                    }
                }
            });

            // COMPETITOR CHART
            const competitorCtx = document.getElementById('competitorChart').getContext('2d');
            if (chartInstances.competitor) chartInstances.competitor.destroy();
            
            const competitorDataPoints = competitorData.length > 0 ? competitorData : [
                { name: 'Competitor A', completeness: 85, satisfaction: 72, market_share: 25 },
                { name: 'Competitor B', completeness: 65, satisfaction: 68, market_share: 15 },
                { name: 'Your Product', completeness: 75, satisfaction: 82, market_share: 10 },
                { name: 'Competitor C', completeness: 55, satisfaction: 60, market_share: 12 }
            ];

            chartInstances.competitor = new Chart(competitorCtx, {
                type: 'scatter',
                data: {
                    datasets: competitorDataPoints.map((comp, idx) => ({
                        label: comp.name || `Competitor ${idx + 1}`,
                        data: [{ x: comp.completeness, y: comp.satisfaction }],
                        backgroundColor: idx === 2 ? 'rgba(58, 143, 195, 0.8)' : 'rgba(176, 166, 223, 0.3)',
                        borderColor: idx === 2 ? '#3A8FC3' : '#B0A6DF',
                        borderWidth: 2,
                        pointRadius: comp.market_share ? Math.sqrt(comp.market_share) * 2 : 8,
                        pointHoverRadius: 10
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#B0A6DF' }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Feature Completeness', color: '#B0A6DF' },
                            ticks: { color: 'rgba(176, 166, 223, 0.6)' },
                            grid: { color: 'rgba(176, 166, 223, 0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'Customer Satisfaction', color: '#B0A6DF' },
                            ticks: { color: 'rgba(176, 166, 223, 0.6)' },
                            grid: { color: 'rgba(176, 166, 223, 0.1)' }
                        }
                    }
                }
            });
        }

        function renderSignals() {
            const container = document.getElementById('signalsList');
            
            if (!allSignals || allSignals.length === 0) {
                container.innerHTML = '<div style="color: rgba(176, 166, 223, 0.6);">No signals available</div>';
                return;
            }

            const filtered = getFilteredSignals();
            container.innerHTML = '';

            filtered.slice(0, 25).forEach(signal => {
                const item = document.createElement('div');
                item.className = 'signal-item';
                item.innerHTML = `
                    <div class="signal-meta">
                        <span class="signal-platform">${signal.platform || 'Unknown'}</span>
                        <span class="signal-date">${signal.date || 'Recently'}</span>
                    </div>
                    <div class="signal-text">"${signal.text || 'Signal text'}"</div>
                    <div class="signal-analysis">${signal.analysis || 'Market insight'}</div>
                    <div class="signal-confidence">Confidence: ${signal.confidence || 85}%</div>
                `;
                container.appendChild(item);
            });
        }

        function getFilteredSignals() {
            const platformFilter = document.getElementById('platformFilter').value;
            const sentimentFilter = document.getElementById('sentimentFilter').value;

            return allSignals.filter(signal => {
                if (platformFilter && signal.platform !== platformFilter) return false;
                if (sentimentFilter && signal.sentiment !== sentimentFilter) return false;
                return true;
            });
        }

        function filterSignals() {
            renderSignals();
        }

        function renderRecommendations(recommendations) {
            const container = document.getElementById('recommendationsGrid');
            container.innerHTML = '';

            if (!recommendations || recommendations.length === 0) {
                container.innerHTML = '<div style="color: rgba(176, 166, 223, 0.6);">No recommendations available</div>';
                return;
            }

            recommendations.forEach((rec, idx) => {
                const card = document.createElement('div');
                card.className = 'recommendation-card';
                card.innerHTML = `
                    <div class="rec-priority">Priority ${idx + 1}</div>
                    <div class="rec-title">${rec.title || 'Recommendation'}</div>
                    <div class="rec-description">${rec.description || ''}</div>
                    <div class="rec-meta">
                        <span>Impact: ${rec.impact || 'High'}</span>
                        <span>Confidence: ${rec.confidence || 85}%</span>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function exportFormat(format) {
            window.location.href = `/api/export/${format}/${projectId}`;
        }

        // INITIALIZE
        loadDashboard();
    </script>
</body>
</html>
